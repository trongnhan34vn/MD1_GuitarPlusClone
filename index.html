<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Guitar Plus</title>
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Oswald:wght@300&family=Roboto:ital,wght@0,500;0,700;1,300&display=swap"
            rel="stylesheet" />
        <link
            rel="shortcut icon"
            type="image/x-icon"
            href="https://theme.hstatic.net/200000388065/1000766714/14/logo.png?v=111" />
        <link
            rel="stylesheet"
            href="fonts/fontawesome-free-6.2.0-web/css/all.css" />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" />
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css" />
        <!--    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">-->
        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>
        <link rel="stylesheet" href="css/base.css" />
        <link rel="stylesheet" href="css/main.css" />
        <script src="script/Products.js"></script>
    </head>

    <body>
        <div class="app">
            <!-- Header -->
            <div class="header">
                <div id="header" class="header-navbar__contact">
                    <div id="navContact" class="header-navbar__contact-item">
                        <i class="fa-sharp fa-solid fa-house-chimney"></i>
                        <a href="">Hệ thống cửa hàng</a>
                    </div>
                    <div class="header-navbar__contact-item">
                        <i class="fa-solid fa-phone"></i>
                        <a href="">Mua hàng online: 0969436769</a>
                    </div>
                </div>
                <div
                    id="navbar"
                    class="header-navbar-feat header-navbar-feat--index">
                    <div class="grid">
                        <div class="header-navbar-container">
                            <div class="header-navbar-item">
                                <div class="header-navbar__logo">
                                    <a href="index.html">
                                        <img
                                            src="https://theme.hstatic.net/200000388065/1000766714/14/logo.png?v=111"
                                            alt="" />
                                    </a>
                                </div>
                            </div>
                            <div class="header-navbar-feature-container">
                                <div class="header-navbar-item">
                                    <ul class="header-navbar__lists-item">
                                        <li>
                                            <a href=""
                                                >Sản phẩm
                                                <i
                                                    class="fa-solid fa-angle-down"></i
                                            ></a>
                                        </li>
                                        <li><a href="">Sản phẩm mới</a></li>
                                        <li>
                                            <a href=""
                                                >Thương hiệu
                                                <i
                                                    class="fa-solid fa-angle-down"></i
                                            ></a>
                                        </li>
                                        <li><a href="">Blog</a></li>
                                        <li>
                                            <a href=""
                                                >Giới thiệu
                                                <i
                                                    class="fa-solid fa-angle-down"></i
                                            ></a>
                                        </li>
                                        <li><a href="">Liên hệ</a></li>
                                    </ul>
                                </div>
                                <div class="header-navbar-item">
                                    <ul class="header-navbar__features">
                                        <li class="nav-search">
                                            <span
                                                ><i class="bi bi-search"></i
                                            ></span>
                                            <div class="nav-search-container">
                                                <input
                                                    placeholder="Tìm kiếm..."
                                                    type="text" />
                                                <button>
                                                    <i
                                                        class="fa-solid fa-magnifying-glass"></i>
                                                </button>
                                            </div>
                                        </li>
                                        <li class="nav-account">
                                            <span
                                                ><i
                                                    class="bi bi-person-circle"></i
                                                ><span id="account"
                                                    >Tài khoản</span
                                                ></span
                                            >
                                            <!-- Regis & Login -->
                                            <div class="nav-account-container">
                                                <a
                                                    class="sign-up account-info"
                                                    href="register.html"
                                                    >Đăng kí</a
                                                >
                                                <a
                                                    class="sign-in account-cart"
                                                    href="login.html"
                                                    >Đăng nhập</a
                                                >
                                                <a
                                                    onclick="logOut()"
                                                    class="logOut"
                                                    href="#"></a>
                                            </div>
                                        </li>
                                        <li class="mini-cart-contain">
                                            <a
                                                id="cart-product"
                                                href="cart-products.html">
                                                <span
                                                    ><i
                                                        class="bi bi-bag-fill"></i>
                                                    Giỏ hàng</span
                                                ><span id="count"></span
                                            ></a>
                                            <div class="mini-cart">
                                                <h3>Thông tin giỏ hàng</h3>
                                                <div
                                                    id="showMiniCart"
                                                    class="mini-cart-body">
                                                    <!--                                            Đây là giỏ hàng-->
                                                    <!--                                            <img src="https://bizweb.dktcdn.net/100/187/527/themes/504306/assets/empty_cart.png?1666747878392" alt="">-->
                                                </div>
                                                <div class="mini-cart-footer">
                                                    <p
                                                        class="mini-cart__products-remain">
                                                        Còn
                                                        <span
                                                            id="productsRemain"></span>
                                                        sản phẩm
                                                    </p>
                                                    <a
                                                        id="mini-cart-product"
                                                        href="cart-products.html"
                                                        >Xem giỏ hàng</a
                                                    >
                                                </div>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="path path-header">
                <div class="grid">
                    <a style="text-decoration: none; color: var(--primay-color)" href="index.html">
                        <h1>Trang chủ</h1>
                    </a>
                </div>
            </div>
            <div class="slider">
                <i class="fa-solid fa-angle-left slider-prev"></i>
                <div class="slider-wraper">
                    <div class="slider-main">
                        <div class="slider-item">
                            <img
                                src="img/slider/item1.jpeg"
                                alt="" />
                        </div>
                        <div class="slider-item">
                            <img
                                src="img/slider/item2.jpeg"
                                alt="" />
                        </div>
                        <div class="slider-item">
                            <img
                                src="img/slider/item3.jpeg"
                                alt="" />
                        </div>
                        <div class="slider-item">
                            <img src="img/slider/item4.jpeg"
                                alt="">
                        </div>
                        <div class="slider-item">
                            <img src="img/slider/item5.jpeg"
                                alt="">
                        </div>
                        <div class="slider-item">
                            <img src="img/slider/item6.jpeg"
                                alt="">
                        </div>
                        <div class="slider-item">
                            <img src="img/slider/item7.webp"
                                alt="">
                        </div>
                    </div>
                </div>
                <i class="fa-solid fa-angle-right slider-next"></i>
            </div>
            <div class="products">
                <div class="grid">
                    <div class="best-sale-title">
                        <a href="#"> Sản phẩm bán chạy </a>
                    </div>
                    <div class="best-sale-products">
                        <div class="grid__row draw">
                            <!--                    <div class="grid__column-12">-->
                            <!--                        <div class="best-sale-products-item-wrap">-->
                            <!--                            <div style="background-image: url(https://product.hstatic.net/200000388065/product/859cf541-b3c3-40bc-a43c-2ab90feb1e55_6f98e69436884d77a3cf97a4b0f9683f_large.jpg)"-->
                            <!--                                 class="best-sale-products-img">-->

                            <!--                            </div>-->
                            <!--                            <div class="best-sale-products-desc">-->
                            <!--                                <h3 class="best-sale-products__title name-products">Amp Marshal MG10G 10W</h3>-->
                            <!--                                <h3 class="best-sale-products__price price">2.000.000 <span>đ</span></h3>-->
                            <!--                            </div>-->
                            <!--                            <a id="add-cart" class="best-sale-products__link cart-link add-cart" href="cart-products.html">-->
                            <!--                                <div class="best-sale-products__extention">-->
                            <!--                                    <span>Thêm vào giỏ hàng</span>-->
                            <!--                                </div>-->
                            <!--                            </a>-->
                            <!--                        </div>-->
                            <!--                    </div>-->
                        </div>
                    </div>
                </div>
            </div>
            <div id="toast"></div>
            <div class="extention">
                <div
                    class="extention-img"
                    style="
                        background-image: url(https://theme.hstatic.net/200000388065/1000766714/14/background_banner.jpg?v=111);
                    "></div>
                <div class="extention-service">
                    <div class="grid">
                        <div class="grid__row">
                            <div class="grid__column-12-4">
                                <div class="extention-service-wrap">
                                    <img class="extention-service-icon" 
                                        src="https://theme.hstatic.net/200000388065/1000766714/14/vice_item_1.png?v=111"
                                        alt="" />
                                    <h3 class="extention-content">Giao hàng miễn phí</h3>
                                    <p>với đơn hàng từ 500k trở lên</p>
                                </div>
                            </div>
                            <div class="grid__column-12-4">
                                <div class="extention-service-wrap">
                                    <img class="extention-service-icon"
                                        src="https://theme.hstatic.net/200000388065/1000766714/14/vice_item_2.png?v=111"
                                        alt="" />
                                    <h3 class="extention-content">Hỗ trợ online 24/7</h3>
                                    <p>Hỗ trợ online/offline 24/7</p>
                                </div>
                            </div>
                            <div class="grid__column-12-4">
                                <div class="extention-service-wrap">
                                    <img class="extention-service-icon" 
                                        src="https://theme.hstatic.net/200000388065/1000766714/14/vice_item_3.png?v=111"
                                        alt="" />
                                    <h3 class="extention-content">Đặt hàng trực tuyến</h3>
                                    <p>Hotline : 0969436769</p>
                                </div>
                            </div>
                            <div class="grid__column-12-4">
                                <div class="extention-service-wrap">
                                    <img class="extention-service-icon"
                                        src="https://theme.hstatic.net/200000388065/1000766714/14/vice_item_4.png?v=111"
                                        alt="" />
                                    <h3 class="extention-content">Miễn phí đổi trả</h3>
                                    <p>Trong vòng 7 ngày</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="footer">
                <div class="grid">
                    <div class="footer-container">
                        <div class="footer-logo">
                            <img
                                src="https://theme.hstatic.net/200000388065/1000766714/14/logo.png?v=111"
                                alt="" />
                        </div>
                        <ul class="footer-social">
                            <li>
                                <a href=""><i class="bi bi-youtube"></i></a>
                            </li>
                            <li>
                                <a href=""><i class="bi bi-instagram"></i></a>
                            </li>
                            <li>
                                <a href=""><i class="bi bi-facebook"></i></a>
                            </li>
                            <li>
                                <a href=""><i class="bi bi-twitter"></i></a>
                            </li>
                        </ul>
                        <div class="footer-copyright">
                            <h3>© 2021 GUITARPLUS • ALL RIGHTS RESERVED</h3>
                        </div>
                        <ul class="footer-link">
                            <li><a href="">Trang chủ</a></li>
                            <li><a href="">Sản phẩm</a></li>
                            <li><a href="">Thương hiệu</a></li>
                            <li><a href="">Blog</a></li>
                            <li><a href="">Giới thiệu</a></li>
                            <li><a href="">Liên hệ</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <script>
            let listUsers = JSON.parse(localStorage.getItem("list_user"));
            let currentUser = JSON.parse(localStorage.getItem("current_user"));

            function showListProducts() {
                let draw = "";
                let link;
                if (currentUser !== null) {
                    link = "javascript:void(0)"; // disable thẻ a. ko bị nhảy, không chuyển trang
                } else {
                    link = "login.html";
                }
                for (let i = 0; i < listProducts.length; i++) {
                    draw += `<div class="grid__column-12">
                        <div class="best-sale-products-item-wrap">
                            <div style="background-image: url(${
                                listProducts[i].img
                            })"
                                 class="best-sale-products-img">

                            </div>
                            <div class="best-sale-products-desc">
                                <h3 class="best-sale-products__title name-products">${
                                    listProducts[i].name
                                }</h3>
                                <h3 class="best-sale-products__price price">${listProducts[
                                    i
                                ].price
                                    .toString()
                                    .replace(
                                        /\B(?=(\d{3})+(?!\d))/g,
                                        "."
                                    )} <span>đ</span></h3>
                            </div>
                            <a id="${
                                listProducts[i].id
                            }" class="best-sale-products__link cart-link add-cart" href=${link} onclick="getIdProducts(${
                        listProducts[i].id
                    })">
                                <div class="best-sale-products__extention">
                                    <span>Thêm vào giỏ hàng</span>
                                </div>
                            </a>
                        </div>
                    </div>`;
                }
                document.querySelector(".draw").innerHTML = draw;
            }

            showListProducts();

            // Kiểm tra đăng nhập

            if (currentUser !== null) {
                document.getElementById("account").innerHTML =
                    currentUser.firstName + " " + currentUser.lastName;
                document.querySelector(".account-info").innerHTML =
                    "Thông tin tài khoản";
                document.querySelector(".account-info").href =
                    "account-information.html";
                document.querySelector(".account-cart").innerHTML = "Giỏ hàng";
                document.querySelector(".logOut").innerHTML = "Đăng xuất";
                document.querySelector(".logOut").style.color = "red";
                document.querySelector(".account-cart").href =
                    "cart-products.html";
            } else {
                document.querySelector(".logOut").style.display = "none";
                document.getElementById("cart-product").href = "login.html";
                document.getElementById("mini-cart-product").href =
                    "login.html";
            }

            // Lấy giỏ hàng của User về cartList

            let cartList = JSON.parse(localStorage.getItem("cartList"));
            if (cartList == null) {
                cartList = [];
            }

            function getIdProducts(id) {
                let product = findById(id);
                let status = false;
                showToast();
                for (let i = 0; i < cartList.length; i++) {
                    if (
                        cartList[i].id == id &&
                        cartList[i].userId == currentUser.id
                    ) {
                        cartList[i].quantity += 1;
                        // console.log(cartList[i].quantity);
                        // console.log(cartList.length)
                        status = true;
                        break;
                    }
                }
                if (status == false) {
                    cartList.push({
                        userId: currentUser.id,
                        id: id,
                        price: product.price,
                        name: product.name,
                        quantity: 1,
                        image: product.img,
                    });
                }
                console.log(cartList);
                localStorage.setItem("cartList", JSON.stringify(cartList));
                countProducts();
                showMiniCart();
            }

            function findById(id) {
                for (let i = 0; i < listProducts.length; i++) {
                    if (listProducts[i].id == id) {
                        return listProducts[i];
                    }
                }
                return null;
            }

            // Hiển thị tổng sản phẩm trong giỏ hàng

            // Lấy ra sản phẩm trong giỏ hàng theo id, push vào mảng, để tính toán và vẽ

            function getCartUser() {
                let cartCurrentUser = [];
                if (currentUser !== null) {
                    for (let i = 0; i < cartList.length; i++) {
                        if (cartList[i].userId == currentUser.id) {
                            cartCurrentUser.push(cartList[i]);
                        }
                    }
                }
                return cartCurrentUser;
            }

            // Tính tổng sản phẩm trong giỏ hàng "countProducts", sản phẩm còn lại trong giỏ "remainP"

            function countProducts() {
                let remainProduct = 0;
                let countProducts = 0;
                let cartCurrentUser = getCartUser();
                if (currentUser !== null) {
                    for (let i = 0; i < cartCurrentUser.length; i++) {
                        if (cartCurrentUser[i].userId == currentUser.id) {
                            countProducts += cartCurrentUser[i].quantity;
                        }
                    }
                }
                if (cartCurrentUser.length < 4) {
                    remainProduct = 0;
                } else {
                    remainProduct = countProducts - 4;
                }

                document.getElementById("count").innerHTML = countProducts;
                document.getElementById("productsRemain").innerHTML =
                    remainProduct;
            }

            countProducts();

            //  Vẽ minicart

            function showMiniCart() {
                let size;
                let showMiniCart = "";
                let cartCurrentUser = getCartUser();

                if (currentUser !== null) {
                    size =
                        cartCurrentUser.length >= 4
                            ? 4
                            : cartCurrentUser.length;
                    for (let i = 0; i < size; i++) {
                        showMiniCart += `<a href="cart-products.html" class="mini-cart-item">
                                                <div class="mini-cart-products">
                                                    <div class="mini-cart-img-contain">
                                                        <img src=${
                                                            cartCurrentUser[i]
                                                                .image
                                                        } alt="">
                                                    </div>
                                                    <h3>${
                                                        cartCurrentUser[i].name
                                                    }</h3>
                                                </div>
                                                <div class="mini-cart-price">
                                                    <p>${formatNumber(
                                                        cartCurrentUser[i].price
                                                    )}</p>
                                                </div>
                                            </a>`;
                    }
                }
                document.getElementById("showMiniCart").innerHTML =
                    showMiniCart;
            }

            showMiniCart();

            function formatNumber(number) {
                return new Intl.NumberFormat("de-DE", {
                    style: "currency",
                    currency: "VND",
                }).format(number);
            }

            // Show toasts
            if (currentUser !== null) {
                function showToast() {
                    let toast = document.createElement("div");
                    toast.classList.add("toast");

                    const autoRemove = setTimeout(function () {
                        toast.remove();
                    }, 4000);

                    toast.style.animation = "slideIn ease .3s";
                    toast.innerHTML = `<div class="toast-message">
                                <div class="toast-icon">
                                    <i class="fa-regular fa-circle-check"></i>
                                </div>
                                <div class="toast-body">
                                    <h3>
                                        Thêm vào giỏ hàng thành công!
                                    </h3>
                                </div>
                                <div onclick="closeToast()" class="toast-close">
                                    <i class="fa-solid fa-xmark"></i>
                                </div>
                            </div>`;

                    const toastList = document.querySelector("#toast");
                    toastList.appendChild(toast);

                    setTimeout(function () {
                        toast.style.animation = `fadeOut ease 3s forwards`;
                    }, 2000);
                }
            }

            // Đăng xuất

            function logOut() {
                localStorage.removeItem("current_user");
                localStorage.removeItem("idKey");
                location.reload();
            }
        </script>
        <script src="script/slider.js"></script>
        <script src="script/fixedBar.js"></script>
    </body>
</html>
